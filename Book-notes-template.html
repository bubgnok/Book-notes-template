<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>패들렛형 독서노트</title>
  <style>
    :root{--bg:#fbfaf8;--card:#ffffff;--muted:#6b7280;--accent:#6b5ce5;--accent-2:#f59e0b}
    *{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",Arial}
    body{margin:0;background:linear-gradient(180deg,#fbfbff, #fff);color:#111}
    header{display:flex;align-items:center;justify-content:space-between;padding:14px 20px;border-bottom:1px solid rgba(0,0,0,0.06);background:rgba(255,255,255,0.6);backdrop-filter:blur(4px)}
    .logo{display:flex;gap:12px;align-items:center}
    .logo-mark{width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#9b8ef0);display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
    nav{display:flex;gap:10px;align-items:center}
    nav button{background:transparent;border:none;padding:8px 10px;border-radius:8px;cursor:pointer;font-weight:600;color:var(--muted)}
    nav button.active{color:var(--accent);background:rgba(107,70,193,0.06)}
    .container{display:grid;grid-template-columns:320px 1fr;gap:18px;max-width:1200px;margin:20px auto;padding:18px}
    /* left panel */
    .panel{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(12,18,33,0.05)}
    .form-row{display:flex;gap:8px}
    label{font-size:13px;color:var(--muted);margin-bottom:6px;display:block}
    input[type=text],input[type=date],textarea,select{width:100%;padding:10px;border-radius:8px;border:1px solid #eef2f6}
    textarea{min-height:80px;resize:vertical}
    .small{font-size:13px;color:var(--muted)}
    .controls{display:flex;gap:8px;margin-top:10px}
    .btn{background:var(--accent);color:white;padding:8px 10px;border-radius:8px;border:none;cursor:pointer}
    .btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(107,70,193,0.12)}
    .meta{display:flex;gap:8px;align-items:center}
    .timer{display:flex;gap:8px;align-items:center}
    /* board */
    .board-wrap{padding:4px}
    .board{column-count:3;column-gap:14px}
    @media(max-width:1000px){.container{grid-template-columns:1fr} .board{column-count:2}}
    @media(max-width:640px){.board{column-count:1}}
    .card{display:inline-block;width:100%;background:var(--card);border-radius:10px;padding:12px;margin:0 0 14px;box-shadow:0 6px 18px rgba(12,18,33,0.04);break-inside:avoid}
    .card h3{margin:0 0 6px;font-size:16px}
    .card .meta{font-size:13px;color:var(--muted);margin-bottom:8px}
    .tags{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
    .tag{background:#eef2ff;color:#3730a3;padding:6px 8px;border-radius:999px;font-size:12px}
    .tiny{font-size:12px;color:var(--muted)}
    /* modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.35);z-index:60}
    .modal.open{display:flex}
    .modal .dialog{width:min(920px,96vw);max-height:92vh;overflow:auto;background:white;border-radius:12px;padding:18px}
    .flex{display:flex;gap:12px}
    .cover-thumb{width:120px;height:160px;border-radius:8px;background:#f3f4f6;object-fit:cover}
    .stat-grid{display:flex;gap:10px;margin-top:10px}
    .stat{flex:1;background:#fff8f2;border-radius:8px;padding:10px;border:1px solid rgba(245,158,11,0.08);text-align:center}
    footer{max-width:1200px;margin:18px auto;text-align:center;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <header>
    <div class="logo">
      <div class="logo-mark">책</div>
      <div>
        <div style="font-weight:700">내 독서벽 (패들렛형)</div>
        <div class="small">한 권에 집중하는 카드형 독서 노트</div>
      </div>
    </div>
    <nav>
      <button id="btnBoard" class="active">메모 보기</button>
      <button id="btnRecord">기록하기</button>
      <button id="btnLibrary">작은 도서관</button>
      <button id="btnStats">통계</button>
      <button id="btnImport" class="ghost">불러오기</button>
      <input id="fileInput" type="file" accept="application/json" style="display:none" />
    </nav>
  </header>

  <div class="container">
    <!-- left: form / controls -->
    <div class="panel" id="leftPanel">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:700">기록하기</div>
        <div class="small">로컬 저장</div>
      </div>

      <div style="margin-top:10px">
        <label>책 제목</label>
        <input id="title" type="text" placeholder="책 제목을 입력하세요" />
      </div>

      <div class="form-row" style="margin-top:8px">
        <div style="flex:1">
          <label>저자</label>
          <input id="author" type="text" placeholder="저자" />
        </div>
        <div style="width:140px">
          <label>읽은 날짜</label>
          <input id="dateRead" type="date" />
        </div>
      </div>

      <div class="form-row" style="margin-top:8px">
        <div style="flex:1">
          <label>읽은 페이지(예: 10-85)</label>
          <input id="pages" type="text" placeholder="읽은 페이지 범위" />
        </div>
        <div style="width:120px">
          <label>장르</label>
          <select id="genre"><option value="기타">기타</option><option>문학</option><option>역사</option><option>사회과학</option><option>자기계발</option></select>
        </div>
      </div>

      <div style="margin-top:8px">
        <label>기억에 남는 문장</label>
        <textarea id="quote" placeholder="매우 인상깊은 한 문장"></textarea>
      </div>

      <div style="margin-top:8px">
        <label>내가 주인공이었다면...</label>
        <textarea id="ifHero" placeholder="만약 내가 주인공이라면 어떻게 했을까? 감정이나 상상 기록"></textarea>
      </div>

      <div class="form-row" style="margin-top:8px;align-items:center">
        <div style="flex:1">
          <label>태그(쉼표로 구분)</label>
          <input id="tags" type="text" placeholder="예: 감성,짧은글" />
        </div>
        <div style="width:120px;text-align:center">
          <label>인생책</label>
          <div><input id="lifeBook" type="checkbox" /></div>
        </div>
      </div>

      <div style="margin-top:8px">
        <label>사진 첨부</label>
        <input id="coverInput" type="file" accept="image/*" />
      </div>

      <div style="margin-top:10px;display:flex;gap:8px;align-items:center">
        <div class="timer">
          <button id="timerBtn" class="btn ghost">타이머 시작</button>
          <div class="small" id="timerDisplay">00:00</div>
        </div>
      </div>

      <div class="controls">
        <button id="saveBtn" class="btn">저장</button>
        <button id="clearBtn" class="btn ghost">초기화</button>
        <button id="exportBtn" class="btn ghost">내보내기(.md)</button>
      </div>

      <div style="margin-top:12px" class="small">저장된 카드 수: <span id="count">0</span></div>

    </div>

    <!-- right: board / views -->
    <div>
      <div class="panel board-wrap" id="boardView">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <div style="font-weight:700">메모 보기</div>
          <div class="small">카드를 클릭하면 상세 보기</div>
        </div>
        <div class="board" id="board"></div>
      </div>

      <div class="panel" id="libraryView" style="display:none;margin-top:14px">
        <div style="font-weight:700">작은 도서관</div>
        <div style="margin-top:8px" id="libraryList"></div>
      </div>

      <div class="panel" id="statsView" style="display:none;margin-top:14px">
        <div style="font-weight:700">통계</div>
        <div class="stat-grid" id="statGrid" style="margin-top:10px">
          <div class="stat"><div class="small">전체 카드</div><div id="statTotal" style="font-weight:700;font-size:18px">0</div></div>
          <div class="stat"><div class="small">인생책</div><div id="statLife" style="font-weight:700;font-size:18px">0</div></div>
          <div class="stat"><div class="small">이번 달</div><div id="statMonth" style="font-weight:700;font-size:18px">0</div></div>
        </div>
        <canvas id="genreChart" style="width:100%;height:160px;margin-top:12px"></canvas>
      </div>
    </div>
  </div>

  <!-- modal -->
  <div class="modal" id="modal">
    <div class="dialog">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:700" id="modalTitle">상세 보기</div>
        <div>
          <button id="editBtn" class="btn ghost">편집</button>
          <button id="delBtn" class="btn ghost">삭제</button>
          <button id="closeBtn" class="btn">닫기</button>
        </div>
      </div>
      <div style="margin-top:10px" id="modalContent"></div>
    </div>
  </div>

  <footer>간단한 로컬 독서노트 — 저장은 브라우저 localStorage에 보관됩니다.</footer>

  <script>
    const LS_KEY = 'padletBookNotes_v1';
    let notes = JSON.parse(localStorage.getItem(LS_KEY)||'[]');
    let timerInterval = null; let timerSeconds = 0;
    let editingId = null;

    // elements
    const board = document.getElementById('board');
    const countEl = document.getElementById('count');
    const titleEl = document.getElementById('title');
    const authorEl = document.getElementById('author');
    const dateReadEl = document.getElementById('dateRead');
    const pagesEl = document.getElementById('pages');
    const genreEl = document.getElementById('genre');
    const quoteEl = document.getElementById('quote');
    const ifHeroEl = document.getElementById('ifHero');
    const tagsEl = document.getElementById('tags');
    const lifeBookEl = document.getElementById('lifeBook');
    const coverInput = document.getElementById('coverInput');
    const timerBtn = document.getElementById('timerBtn');
    const timerDisplay = document.getElementById('timerDisplay');
    const saveBtn = document.getElementById('saveBtn');
    const clearBtn = document.getElementById('clearBtn');
    const exportBtn = document.getElementById('exportBtn');
    const fileInput = document.getElementById('fileInput');

    const modal = document.getElementById('modal');
    const modalContent = document.getElementById('modalContent');
    const modalTitle = document.getElementById('modalTitle');
    const closeBtn = document.getElementById('closeBtn');
    const editBtn = document.getElementById('editBtn');
    const delBtn = document.getElementById('delBtn');

    const btnBoard = document.getElementById('btnBoard');
    const btnRecord = document.getElementById('btnRecord');
    const btnLibrary = document.getElementById('btnLibrary');
    const btnStats = document.getElementById('btnStats');
    const btnImport = document.getElementById('btnImport');

    const leftPanel = document.getElementById('leftPanel');
    const libraryView = document.getElementById('libraryView');
    const boardView = document.getElementById('boardView');
    const statsView = document.getElementById('statsView');

    // helpers
    function uid(){return 'n'+Math.random().toString(36).slice(2,9)}
    function fmtTime(s){const m=Math.floor(s/60);const sec=s%60;return `${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}`}
    function saveAll(){localStorage.setItem(LS_KEY,JSON.stringify(notes));}

    // render board
    function renderBoard(){board.innerHTML='';
      notes.forEach(n=>{
        const el = document.createElement('div');el.className='card';
        el.innerHTML = `
          ${n.cover?'<img src="'+n.cover+'" class="cover-thumb" style="float:right;margin-left:8px">':''}
          <h3>${escapeHtml(n.title||'무제')}</n3>
          <div class="meta">${escapeHtml(n.author||'저자 없음')} • ${n.dateRead||''} • ${escapeHtml(n.genre||'')}</div>
          <div class="tiny">${(n.quote||'').slice(0,120)}</div>
          <div class="tags">${(n.tags||[]).map(t=>'<span class="tag">'+escapeHtml(t)+'</span>').join('')}</div>
        `;
        el.addEventListener('click',()=>openModal(n.id));
        board.appendChild(el);
      });
      countEl.textContent = notes.length;
    }

    function escapeHtml(s){return String(s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;')}

    // modal
    function openModal(id){
      const n = notes.find(x=>x.id===id); if(!n) return;
      editingId = id;
      modalTitle.textContent = n.title||'상세 보기';
      modalContent.innerHTML = `
        <div class="flex">
          <div style="flex:1">
            <div class="small">저자</div><div style="font-weight:700">${escapeHtml(n.author||'')}</div>
            <div style="margin-top:8px" class="small">읽은 날짜</div><div>${n.dateRead||''}</div>
            <div style="margin-top:8px" class="small">읽은 페이지</div><div>${escapeHtml(n.pages||'')}</div>
            <div style="margin-top:8px" class="small">장르</div><div>${escapeHtml(n.genre||'')}</div>
            <div style="margin-top:12px" class="small">내가 주인공이라면</div><div>${escapeHtml(n.ifHero||'')}</div>
            <div style="margin-top:12px" class="small">태그</div><div>${(n.tags||[]).map(t=>'<span class="tag">'+escapeHtml(t)+'</span>').join('')}</div>
          </div>
          <div style="width:140px;text-align:center">
            ${n.cover?'<img src="'+n.cover+'" style="width:120px;height:160px;border-radius:8px;object-fit:cover">':'<div style="width:120px;height:160px;background:#f3f4f6;border-radius:8px"></div>'}
            <div style="margin-top:8px" class="tiny">읽은 시간: ${n.time||'00:00'}</div>
            <div class="tiny">인생책: ${n.lifeBook? '예':'아니오'}</div>
          </div>
        </div>
        <hr style="margin:12px 0;border:none;border-top:1px solid #eef2f6">
        <div><strong>기억에 남는 문장</strong><div style="margin-top:6px">${escapeHtml(n.quote||'')}</div></div>
        <div style="margin-top:10px"><strong>메모</strong><div style="margin-top:6px">${escapeHtml(n.memo||'')}</div></div>
      `;
      modal.classList.add('open');
    }

    closeBtn.addEventListener('click',()=>{modal.classList.remove('open');editingId=null});
    delBtn.addEventListener('click',()=>{
      if(!editingId) return; if(!confirm('정말 삭제하시겠어요?')) return;
      notes = notes.filter(n=>n.id!==editingId); saveAll(); renderBoard(); modal.classList.remove('open');editingId=null; alert('삭제되었습니다');
    });

    editBtn.addEventListener('click',()=>{
      if(!editingId) return; const n = notes.find(x=>x.id===editingId); if(!n) return;
      // load into form
      titleEl.value = n.title||''; authorEl.value = n.author||''; dateReadEl.value = n.dateRead||''; pagesEl.value = n.pages||''; genreEl.value = n.genre||'기타'; quoteEl.value = n.quote||''; ifHeroEl.value = n.ifHero||''; tagsEl.value = (n.tags||[]).join(','); lifeBookEl.checked = !!n.lifeBook; editingId = n.id;
      modal.classList.remove('open');
      // scroll to form (if mobile)
      window.scrollTo({top:0,behavior:'smooth'});
    });

    // save
    saveBtn.addEventListener('click',async ()=>{
      const data = {
        id: editingId || uid(),
        title: titleEl.value.trim(),
        author: authorEl.value.trim(),
        dateRead: dateReadEl.value || new Date().toISOString().slice(0,10),
        pages: pagesEl.value.trim(),
        genre: genreEl.value,
        quote: quoteEl.value.trim(),
        ifHero: ifHeroEl.value.trim(),
        memo: '',
        tags: tagsEl.value.split(',').map(s=>s.trim()).filter(Boolean),
        lifeBook: lifeBookEl.checked,
        time: fmtTime(timerSeconds),
        cover: null,
        updatedAt: new Date().toISOString()
      };
      // cover file
      const f = coverInput.files[0];
      if(f){
        const reader = new FileReader();
        reader.onload = ()=>{data.cover = reader.result; upsertNote(data);}
        reader.readAsDataURL(f);
      } else { upsertNote(data); }
    });

    function upsertNote(data){
      const idx = notes.findIndex(x=>x.id===data.id);
      if(idx>=0) notes[idx] = Object.assign({},notes[idx],data);
      else notes.unshift(data);
      saveAll(); renderBoard(); renderLibrary(); renderStats(); resetForm(); alert('저장되었습니다');
    }

    function resetForm(){ titleEl.value='';authorEl.value='';dateReadEl.value='';pagesEl.value='';genreEl.value='기타';quoteEl.value='';ifHeroEl.value='';tagsEl.value='';lifeBookEl.checked=false;coverInput.value=''; timerSeconds = 0; timerDisplay.textContent = fmtTime(0); timerBtn.textContent='타이머 시작'; editingId = null; }

    clearBtn.addEventListener('click',()=>{ if(!confirm('폼을 초기화하시겠어요?')) return; resetForm(); });

    // timer
    timerBtn.addEventListener('click',()=>{
      if(timerInterval){ clearInterval(timerInterval); timerInterval=null; timerBtn.textContent='타이머 시작'; return; }
      timerInterval = setInterval(()=>{ timerSeconds++; timerDisplay.textContent = fmtTime(timerSeconds); },1000); timerBtn.textContent='타이머 중지';
    });

    // library
    function renderLibrary(){ const wrap = document.getElementById('libraryList'); wrap.innerHTML='';
      const done = notes.map(n=>`<div style="padding:8px;border-bottom:1px solid #f1f3f5"><strong>${escapeHtml(n.title||'무제')}</strong> <div class="tiny">${escapeHtml(n.author||'')} • ${n.dateRead||''}</div></div>`).join('');
      wrap.innerHTML = done || '<div class="small">읽은 책이 없습니다.</div>';
    }

    // stats
    function renderStats(){ document.getElementById('statTotal').textContent = notes.length; document.getElementById('statLife').textContent = notes.filter(n=>n.lifeBook).length; const thisMonth = new Date().toISOString().slice(0,7); document.getElementById('statMonth').textContent = notes.filter(n=>n.dateRead && n.dateRead.startsWith(thisMonth)).length;
      // simple genre chart using canvas
      const canvas = document.getElementById('genreChart'); const ctx = canvas.getContext('2d'); canvas.width = canvas.clientWidth; canvas.height = 160; ctx.clearRect(0,0,canvas.width,canvas.height);
      const counts = {}; notes.forEach(n=>counts[n.genre||'기타'] = (counts[n.genre||'기타']||0)+1);
      const keys = Object.keys(counts); if(keys.length===0) return;
      const total = keys.reduce((s,k)=>s+counts[k],0);
      let x = 10; const barH = 22; keys.forEach((k,i)=>{
        const w = Math.max(6, (counts[k]/total)*(canvas.width-140)); ctx.fillStyle = '#f3f4f6'; ctx.fillRect(120,10 + i*(barH+8), canvas.width-140, barH); ctx.fillStyle = '#6b5ce5'; ctx.fillRect(120,10 + i*(barH+8), w, barH); ctx.fillStyle='#111'; ctx.fillText(`${k} (${counts[k]})`, 10, 10 + i*(barH+8) + 15);
      });
    }

    // export markdown
    exportBtn.addEventListener('click',()=>{
      if(!editingId){ alert('저장 후에 내보내기가 가능합니다. (먼저 저장해 주세요)'); return; }
      const n = notes.find(x=>x.id===editingId); if(!n) return;
      const md = `# ${n.title}\n\n*저자:* ${n.author}\n*읽은 날짜:* ${n.dateRead}\n*읽은 페이지:* ${n.pages}\n*읽은 시간:* ${n.time}\n*장르:* ${n.genre}\n\n## 기억에 남는 문장\n${n.quote}\n\n## 내가 주인공이라면\n${n.ifHero}\n`;
      const blob = new Blob([md],{type:'text/markdown'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = (n.title||'note')+'.md'; a.click(); URL.revokeObjectURL(url);
    });

    // import
    btnImport.addEventListener('click',()=>fileInput.click());
    fileInput.addEventListener('change',async (e)=>{ const f = e.target.files[0]; if(!f) return; const txt = await f.text(); try{ const data = JSON.parse(txt); if(Array.isArray(data)){ notes = data.concat(notes); saveAll(); renderBoard(); renderLibrary(); renderStats(); alert('불러오기 완료'); } else alert('잘못된 형식'); }catch(err){alert('파싱 실패')}
    });

    // navigation
    btnBoard.addEventListener('click',()=>{switchView('board')});
    btnRecord.addEventListener('click',()=>{switchView('record')});
    btnLibrary.addEventListener('click',()=>{switchView('library')});
    btnStats.addEventListener('click',()=>{switchView('stats')});

    function switchView(v){ btnBoard.classList.remove('active'); btnRecord.classList.remove('active'); btnLibrary.classList.remove('active'); btnStats.classList.remove('active'); boardView.style.display='none'; leftPanel.style.display='none'; libraryView.style.display='none'; statsView.style.display='none';
      if(v==='board'){ btnBoard.classList.add('active'); boardView.style.display='block'; leftPanel.style.display='block'; }
      if(v==='record'){ btnRecord.classList.add('active'); leftPanel.style.display='block'; boardView.style.display='block'; }
      if(v==='library'){ btnLibrary.classList.add('active'); libraryView.style.display='block'; leftPanel.style.display='none'; }
      if(v==='stats'){ btnStats.classList.add('active'); statsView.style.display='block'; leftPanel.style.display='none'; renderStats(); }
    }

    // init
    renderBoard(); renderLibrary(); renderStats();

    // click card to set editingId when created: when user saves, set editingId to the new note id
    // when user clicks a card, openModal sets editingId

    // handle cover drag & preview (optional)
    coverInput.addEventListener('change',()=>{});

    // simple autosave every 25s if editing
    setInterval(()=>{ if(editingId){ const n = notes.find(x=>x.id===editingId); if(n) { n.updatedAt = new Date().toISOString(); saveAll(); } } },25000);

    // small helper: if user closes, save
    window.addEventListener('beforeunload',()=>{ saveAll(); });
  </script>
</body>
</html>